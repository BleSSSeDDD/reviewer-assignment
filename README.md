# reviewer-assignment
Backend service for automatic PR reviewer assignment.

# Запуск:

```bash
docker compose up
```

Образ сервера запушен на докерхаб, поэтому для запуска нет необходимости скачивать исходный код.


Сервер был протестирован, подробные результаты тестов можно посмотреть в файле test-results.md, короткий вывод:

Сервер стабильно обрабатывает до 500 RPS с задержкой менее 2 секунд и минимальными ошибками (<0.3%), при пиковой нагрузке в 1000 пользователей сохраняется работоспособность с увеличением задержки до 6 секунд.

# Мои решения:

#1.

Из-за того, что с самого начала я посчитал, что пользователь может находиться в нескольких командах (многие-ко-многим), возникли архитектурные проблемы. 
Если пользователь может быть в нескольких командах одновременно, то логика выбора ревьюеров неоднозначна (не понятно из какой команды их выбирать).
В то же время, спицификация не описывает, что делать в ситуации, когда создается новая команда с участником, который уже был в другой команде.

Если не создавать команду, как отдельную сущьность в базе данных, а как поле в таблице users (многие-к-одному),
то при одновременном запросе могут создаться две разные команды с одинаковым названием и далее они бы считались одной командой.

В итоге для решения была создана таблица teams с уникальными названиями команд, на которую ссылается ячейка из таблицы пользователей.

```sql
    team_name VARCHAR(100) NOT NULL REFERENCES teams(team_name) DEFERRABLE INITIALLY DEFERRED
```

DEFERRABLE INITIALLY DEFERRED для того, чтобы сначала создавать команду в таблице команд, а затем в конце транзакции добавлять её в таблицу пользователей.

Я взял за основу подход, где существующие пользователи могут переходить в вновь созданные команды.

Из-за этого существует проблема:

В таблице teams могут оставаться пустые команды, все пользователи которых "перешли" в новые команды. 

Решить данную проблему можно было бы проверкой при добавлении пользователя в команду, что его старая команда не остаётся пустой после этой операции.
В случае, если она остаётся пустой, необходимо удалять её, чтобы освободить айди, на случай, если эту команду будет решено пересоздать.

К сожалению, мне не хватило времени до отправки задания на реализацию этой логики и многих других мелких поправок, но в будущем они будут реализованы.

#2.

Выбор ревьюеров в текущей реализации:

Берутся все активные участники из команды автора, исключается сам автор, 
Слайс случайно перемешиваются через rand.Shuffle() и выбирается 1, 2, либо 0 ревьюеров с начала слайса.

При переназначении берутся активные участники из команды старого ревьюера (учитывается, что пользователь мог уже перейти в другую команду, как это описано выше),
исключается старый ревьюер, уже назначенные ревьюеры на другие PR от этого пользователя, выбирается 1 случайный из доступных.

#3.

Для обеспечения безопасности от переполнения текстовые поля в базе данных имеют ограничения а длину.
В случае нарушения ограничения длины сервер возвращает 400, "VALUE_TOO_LONG", в случае других ошибок 500




